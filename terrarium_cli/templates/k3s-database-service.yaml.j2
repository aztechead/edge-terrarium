# =============================================================================
# AUTO-GENERATED FILE - DO NOT EDIT MANUALLY
# =============================================================================
# This file is automatically generated by the Terrarium CLI from templates.
# Any manual changes will be overwritten on the next deployment.
# 
# To modify the configuration, edit the app-config.yml files in the apps/ directory
# or update the templates in terrarium_cli/templates/
# =============================================================================

# =============================================================================
# KUBERNETES DATABASE SERVICE MANIFEST
# =============================================================================
# This template generates a Kubernetes Service for a PostgreSQL database.
# It exposes the database to other services within the cluster.
#
# Template Variables:
#   {{ app.name }} - The name of the application
#   {{ db_config.name }} - The name of the database
#   {{ global_config.namespace }} - Kubernetes namespace
#
# Generated Resources:
#   - Service: {{ app.name }}-{{ db_config.name }}-db
#   - Port: 5432 (PostgreSQL default)
#   - Target: {{ app.name }}-{{ db_config.name }}-db pods
# =============================================================================

apiVersion: v1
kind: Service
metadata:
  name: {{ app.name }}-db
  namespace: {{ global_config.namespace }}
  labels:
    app: {{ app.name }}-db
    component: database
    service: {{ app.name }}
spec:
  # =============================================================================
  # SERVICE CONFIGURATION
  # =============================================================================
  type: {% if db_config.port_forward %}NodePort{% else %}ClusterIP{% endif %}  # Internal cluster access only
  
  # =============================================================================
  # PORT CONFIGURATION
  # =============================================================================
  ports:
  - name: postgres
    port: 5432
    targetPort: 5432
    protocol: TCP
    {% if db_config.port_forward %}
    nodePort: {{ db_config.port_forward }}
    {% endif %}
  
  # =============================================================================
  # SELECTOR
  # =============================================================================
  # Selects pods with matching labels
  selector:
      app: {{ app.name }}-db
  
  # =============================================================================
  # SESSION AFFINITY
  # =============================================================================
  # Ensures connections from the same client go to the same pod
  sessionAffinity: None
  
  # =============================================================================
  # EXTERNAL TRAFFIC POLICY
  # =============================================================================
  # Only applies to LoadBalancer and NodePort services
  # externalTrafficPolicy: Cluster
